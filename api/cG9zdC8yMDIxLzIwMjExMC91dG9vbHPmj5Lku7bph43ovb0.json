{"title":"utools插件重载问题","date":"2021-10-27T07:47:05.000Z","date_formatted":{"ll":"2021年10月27日","L":"2021/10/27","MM-DD":"10-27"},"link":"post/2021/202110/utools插件重载","tags":["utools"],"categories":["开发问题"],"updated":"2022-01-31T22:46:53.439Z","content":"<p>utools插件开发 中 plugin.json 中的配置无法生效问题</p>\n<span id=\"more\"></span>\n<h2 id=\"0x10-需求\">0x10 需求<a title=\"#0x10-需求\" href=\"#0x10-需求\"></a></h2>\n<p>最近两天打算找个不限制流量, 不限制容量的 图床, 之前 我一直用阿里云的OSS, 太鸡儿贵了<br>\n因为我看到国外的不少图床 都是免费的 并且不限制容量不限流量, 我太心动了</p>\n<p>所以我打算把我国内的图床 换成国外的图床 然后在国内访问</p>\n<p>想法有了之后 我就开始动手折腾了,把所有的图片上传到国外的图床, 然后通过代理服务器访问就好了</p>\n<p>这就需要转链, 把原本图片的链接 转换成为 通过代理服务器访问的链接,所以我就需要搞个 utools工具  来帮助我方便的转链</p>\n<h2 id=\"0x20-开搞\">0x20 开搞<a title=\"#0x20-开搞\" href=\"#0x20-开搞\"></a></h2>\n<p>这么久没有玩 utools也从1.x 升级到 2.x 了<br>\n不过插件的开发方式还是大同小异</p>\n<p>开发过程挺顺利 不过中途遇到了几个坑, 我再这里记录一下</p>\n<h3 id=\"0x21-utools加载插件的方式变了\">0x21 utools加载插件的方式变了<a title=\"#0x21-utools加载插件的方式变了\" href=\"#0x21-utools加载插件的方式变了\"></a></h3>\n<p>utools 1.x 可以直接加载插件 但是2.x 明显行不通</p>\n<p>2.x 如果你想要加载插件 你就需要首先下载一个 <code>开发者工具</code> 插件 这是一个开发utools插件的 插件, 如下图:<br>\n<img src=\"https://search.pstatic.net/common/?src=https://i.imgur.com/Ns7NmHj.png\" alt=\"space\" loading=\"lazy\"></p>\n<h3 id=\"0x22-utools插件重载\">0x22 utools插件重载<a title=\"#0x22-utools插件重载\" href=\"#0x22-utools插件重载\"></a></h3>\n<p>本次插件开发当中遇到的一个最为蛋疼的问题就是插件重载的问题</p>\n<p>utools 识别不同插件是通过 一个plugin.json的文件<br>\n这个文件里面可以定义  在什么时候什么条件下去唤醒 utools<br>\n我在里面写了个通过正则表达式去匹配链接的方式去唤醒我的插件</p>\n<p>也就是说当我把国外的图床上图片的链接粘贴到utools的时候,utools会用我写好的正则表达式去尝试匹配这个链接,如果匹配成功  则utools 会调用我的插件 对 这个链接进行转链</p>\n<p>但是中途发现一个问题 就是链接 怎么都无法匹配成功<br>\n我一度怀疑是我的正则表达式有问题导致无法成功匹配<br>\n最后调试来调试去 发现 我无论怎么改正则表达式 就是无法匹配, 我才开始怀疑utools</p>\n<p><img src=\"https://search.pstatic.net/common/?src=https://i.imgur.com/ZKgSjT9.png\" alt=\"space\" loading=\"lazy\" class=\"φbp\"></p>\n<p>我已经 <code>图中①</code> 处的开关打开了<br>\n按理说每次我插件UI进入隐藏状态之后 插件就会完全退出 等我再次进入插件 插件的代码都会重载<br>\n本来我以为所有的插件代码都会自动重载</p>\n<p>但是 其实 实际情况并不是我想想的那样 如果你改动的是插件的逻辑代码 当你打开 <code>图中①</code>处的开关时候,插件确实会重载 但是如果你改动的是plugin.json 当中的内容, plugin.json 是不会被自动重载的, utools开发工具的自动重载 仅仅重载你插件的逻辑代码 不会重载你的 plugin.json文件, 这个文件 属于你的插件的配置文件</p>\n<p>好鸡儿蛋疼, 每次更改plugin.json 都需要 手动去重载 这个文件, 就是手动去按<code>图中②</code> 处的更新按钮</p>\n<h3 id=\"0x23-js正则表达式的坑\">0x23 js正则表达式的坑<a title=\"#0x23-js正则表达式的坑\" href=\"#0x23-js正则表达式的坑\"></a></h3>\n<p>还有个比较坑的问题就是js的 正则表达式的坑:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;text string&quot;</span>.match(<span class=\"regexp\">/exp/</span>flags)</span><br></pre></td></tr></table></figure>\n<p>我们使用 正则表达式的时候 一般会使用 不同的flag<br>\njs 的正则表达式 也有各种flag  有  <code>g  i m u y s</code> 等各种flag<br>\n但是在使用 match 函数的 时候 如果你的正则表达式使用的flag中有 <code>g</code> 这个flag<br>\n则match 函数返回的匹配数据当中 不包含正则表达式匹配到的group数据</p>\n<p>mdn 中的原文是这样的:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">If the g flag is used, all results matching the complete regular expression will be returned, but capturing groups will not.</span><br><span class=\"line\">if the g flag is not used, only the first complete match and its related capturing groups are returned. In this case, the returned item will have additional properties as described below.</span><br></pre></td></tr></table></figure>\n<p>一旦你的正则表达式使用了这个g flag,<br>\n则match 函数返回的就不是详细的匹配数据,而仅仅是一个匹配结果,这样的话不是很方便做细致的调试</p>\n","prev":{"title":"checkboxland尝鲜","link":"post/2021/202110/checkboxland尝鲜"},"next":{"title":"利用task调试VSCode配置文件当中的变量","link":"post/2021/202106/利用task调试VSCode配置文件当中的变量__"},"plink":"http://blog.lipanpanx.com/post/2021/202110/utools插件重载/","toc":[{"id":"0x10-需求","title":"0x10 需求","index":"1"},{"id":"0x20-开搞","title":"0x20 开搞","index":"2","children":[{"id":"0x21-utools加载插件的方式变了","title":"0x21 utools加载插件的方式变了","index":"2.1"},{"id":"0x22-utools插件重载","title":"0x22 utools插件重载","index":"2.2"},{"id":"0x23-js正则表达式的坑","title":"0x23 js正则表达式的坑","index":"2.3"}]}],"reward":true,"copyright":{"author":"李攀攀","link":"<a href=\"http://blog.lipanpanx.com/post/2021/202110/utools插件重载/\" title=\"utools插件重载问题\">http://blog.lipanpanx.com/post/2021/202110/utools插件重载/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"},"reading_time":"1118 字约 7 分钟"}